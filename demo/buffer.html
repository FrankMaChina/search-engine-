<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="../lib/jquery-2.1.3.js"></script>
	<script type="text/javascript" src="../lib/searchplugin.js"></script>
	<script type="text/javascript" src="../lib/demo.js"></script>

	<script type="text/javascript" src="../highlighter/scripts/shCore.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushBash.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushCpp.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushCSharp.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushCss.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushDelphi.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushDiff.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushGroovy.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushJava.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushJScript.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushPhp.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushPlain.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushPython.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushRuby.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushScala.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushSql.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushVb.js"></script>
	<script type="text/javascript" src="../highlighter/scripts/shBrushXml.js"></script>
	<link type="text/css" rel="stylesheet" href="../highlighter/styles/shCore.css"/>
	<link type="text/css" rel="stylesheet" href="../highlighter/styles/shThemeDefault.css"/>

	<script type="text/javascript">
		SyntaxHighlighter.config.clipboardSwf = '../highlighter/scripts/clipboard.swf';
		SyntaxHighlighter.all();
		SyntaxHighlighter.config.strings = {
			copyToClipboard:'复制'
		};
	</script>

	<link rel="stylesheet" type="text/css" href="../css/demo.css" />
	<style type="text/css">
		*{
			margin: 0px;
			padding: 0px;
		}
		.header_sty{
			width: 970px;
			margin: 0 auto;
			font-size: 12px;
			
		}
		.logo_sty{
			width: 70px;
			height: 70px;
			text-align: center;
			font-size: 26px;
			color: white;
			line-height: 35px;
			margin-top: 5px;
			background:red;
			border-radius: 8px;
			float: left;
		}
		.header_sty_ul{
			list-style:none;
			display: line-block;

		}
		.header_sty_li{
			float: left;
			width: 75px;
			height: 30px;
			text-align: center;
			border-radius: 5px;
			padding-top:5px; 
			font-size: 14px;
			margin-top: 34px;
			border-color: #fa492b;
			box-shadow: 0 2px 0 #ef2503;
			
			background-color: #fa492b;
			margin-left:5px; 
		}
		.header_sty_li:hover{
			transition:color 0.2s ease-in-out,background-color 0.2s ease-in-out,top 0.1s linear,box-shadow 0.1s linear;
			background: #ef2503;
		}
		.header_sty_li a{
			color: #fff;
			text-decoration: none;
			padding-top:6px;
			display: block; 
		}
		.triangle{
			margin-top: -7px;
			display: block;
			margin-right:1px; 
			width: 0px;
			float: right;
			height: 0px;
			border-left: 4px solid transparent;
			border-right: 4px solid transparent;
			border-top: 5px solid white;
		}
		.intrudoce{
			clear: left;
			width: 970px;
			margin: 0 auto;
			padding-top:50px; 
		}
		.product{
			font-weight: bolder;
		}
	</style>
	<title>缓冲</title>
</head>
<body align="center">
	<div  class="bodydiv" align="center">
		<div class="headerdiv" align="left" id="bodydiv">
			<div id="logo" class="logo_sty"><p>效果演示</p>
			</div>
			<input type="text" placeholder="搜一下吧" id="comment" class="comment" />
			<input type="button" value="搜一下" class="searchbutton" />
		</div>
		<div class="intrudoce" align="left">
		<div class="product">
			<h1>插件说明</h1>
			<section>
				<p style="line-height:30px;padding-top:5px;">本插件能完成搜索的简单功能。包括：</p>
				<ul style="list-style:none;padding-left:10px;line-height:30px;">
					<li>通过ajax引入服务器数据，可以不用刷新页面，完成加载。（所以使用者测试时需要开启服务器，否则没法出效果）</li>
					<li>本插件，可以通过拼音搜索和汉字进行搜索，效果还可以</li>
					<li>本插件，在使用时，有一个缓冲效果，就是输入过快时有200ms的缓冲时间</li>
					<li>暂时完成了按下键盘上下键时可以上下选择出现的选项。(持续更新)</li>
				</ul>
				<p style="line-height:30px;padding-top:5px;padding-bottom:5px;font-weight:bolder;">要使用或是观看效果，一定要把本项目中的所有文件都下载，最后打开服务器，才有效果，用本地打开文件是不会有查询效果的。</p>
			</section>
		</div>
		<h1>样式说明</h1>
		<section style="margin-top:20px;line-height:20px;">
			此插件中包含了12个css样式分别为：<span style="color:red;">(comment,bodydiv,headerdiv,searchbutton,menustyle,showmenu,ulstyle,hidemenu,listyle,listyle:hover,linkstyle,keychoice)</span>;
			<p style="line-height:30px;padding-top:5px;padding-bottom:5px;font-weight:bolder;">这个插件样式不是主要因素，大家可以根据自己的需求进行转换就行了。下面把我用到的样式贴出来，并简单的说明。样式如下：</p>
			
				<pre style="display:block;line-height:20px;" class="brush: css;">
					.comment{
						width: 200px;
						height: 40px;
						border-radius: 5px;//设置圆角css3
						border: none;
						background: #e6eaed;
						outline: none;//去除点击时input出现的框线
						margin-left: 500px;
						margin-top: 30px;
						position: relative;//设置此处是为了使出现的下拉菜单与其位置同步
						padding-left: 10px;
					}
				</pre>
				<p style="line-height:10px;padding-top:2px;padding-bottom:2px;font-weight:bolder;">这个样式为input输入框的样式.</p>
				<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
					.bodydiv{
						width: auto;
						height: 100px;
						border-bottom: 1px solid red;
					}
					.headerdiv{
						width: 970px;
						height: auto;

					}
				</pre>
				<p style="font-weight:border;margin-top:10px;">这个味页面样式（为了使其居中）.</p>
			
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.searchbutton{
					width: 100px;
					height: 30px;
					border: 1px solid red;
					outline: none;
					border-radius: 3px;
					background: #fff;
					margin-left: 20px;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是搜索按钮样式
			</p>
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.menustyle{
					opacity: 0;
					height: 0px;
					background: white;
					position: absolute;
					transition-property:all;//渐变属性
					transition-duration:0.2s;//渐变持续时间
					transition-timing-function:linear;//渐变时间函数
					-webkit-transition-property:all;
					-webkit-transition-duration:0.2s;
					-webkit-transition-timing-function:linear;
					-moz-transition-property:all;
					-moz-transition-duration:0.2s;
					-moz-transition-timing-function:linear;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是菜单的总样式。
			</p>
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.showmenu{
					height: auto;
					line-height: 20px;
					padding-left: 10px;
					z-index: 1000;//覆盖优先级
					opacity: 1;
					height: auto;
					transform-origin:20% 0;//渐变的原点位置
					transform:scale(1);//缩进倍数
					-moz-transform-origin:20% 0;
					-moz-transform:scale(1);
					-webkit-transform-origin:20% 0;
					-webkit-transform:scale(1);
					border-left: 1px solid red;
					border-right: 1px solid red;
					border-bottom: 1px solid red;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是菜单的的显示样式。
			</p>
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.hidemenu{
					opacity: 0;
					height: 0px;
					-moz-transform-origin:20% 0;
					-moz-transform:scale(0);
					-webkit-transform-origin:20% 0;
					-webkit-transform:scale(0);
					transform-origin:20% 0;
					transform:scale(0);//缩进倍数为0，隐藏
					padding-left: 10px;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是菜单的的隐藏样式。（就是当输入框中有字，但点击了页面其他地方时，菜单隐藏）
			</p>
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.ulstyle{
					border: none;
					list-style: none;

				}
				.listyle{
					color: red;
					line-height: 25px;
				}
				.listyle:hover{
					background: #e6eaed;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是显示列表样式。
			</p>
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.linkstyle{
					text-decoration: none;
					color: blue;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是显示的链接样式。
			</p>
			<pre style="display:block;line-height:20px;background:#e6eaed;margin-top:10px;" class="brush: css;">
				.keychoice{
					background: yellow;
				}
			</pre>
			<p style="font-weight:border;margin-top:10px;">
				这个是用上下键选择下拉项时的样式。
			</p>
		</section>
		<h1 style="margin-top:20px;">js说明</h1>
		<section style="margin-top:20px;line-height:20px;border:1px solide #e6eaed;">
			
			<p>使用本插件所需js代码较简单，只需要数据所在的服务器url传入，再指定所需绑定的元素即可，但注意本插件用的是id绑定，如下所示：</p>
			<div style="background:#f7f7f9;margin-top:10px;">
				<pre class="brush: javascript;">
					$(document).ready(function(){
	
					$("#comment").pluginsearch(addressurl);

					
				})
				</pre>
			</div>
			<strong style="margin-top:10px;display:block;">
				$("")引号中的字符一定要是需绑定的标签的id值才能正确绑定,如(#lisecond)，pluginsearch()是需要引用的插件函数名，addressurl是数据在服务器的地址，如(http://127.0.0.1:8080/Documents/%E7%BC%93%E5%86%B2/data/serverdata.txt)。具体数据是一个json的数据。要使用的时候可以根据具体数据的不同，稍加修改。或者参照source文件中，txt中的json格式，写成的数据。
				</strong>
		</section>
		<h1 style="margin-top:20px;">插件代码说明</h1>
		<section style="margin-top:20px;line-height:20px;">
			<pre class="brush: javascript;">
				(function($){
					$.fn.pluginsearch = function(address) {
						var me = this;
						$.ajax({url:address,async:false,dataType:"json",type:"GET",dataFilter:function(data){
							
							ajaxdata = JSON.parse(data);//取出来的是一个字符串，要先转换成一个json对象
							
							}});//用jQuery的ajax取得服务器文件，其数据是一个json数据。
						me.on("keydown",function(event){//绑定键盘的敲击事件
							me.starsearch((ajaxdata.moviename),me);//moviename是我用到的json数据中数组的名字，根据自己的数据改。
							me.choiceaim(event);//这个函数用来控制上下按键
						});
						console.log("3");//测试用的
						return this;
					}
				})(jQuery);
			</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数主要是用来给js调用的。
				</strong><br />
			<pre class="brush: javascript;">
				(function($){
					$.fn.starsearch = function (dataname,node) {
						var me = this;
						if(lasttime) {//清除上次缓冲的时间
						clearTimeout(lasttime);
					}
					lasttime = setTimeout(function() {//缓存300ms
						me.comparadata(dataname,node);//处理输入框中数据的函数
						setTimeout(me.addstyle, 1);
						
					},300);
					me.eventmenu();//菜单的其它事件，如点击页面隐藏等
					}
				})(jQuery);
			</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数是一个开始函数，主要用来缓存300ms在将输入的数据发送到其他函数进行处理。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.choiceaim = function(event) {
							var hasmenu = $("#menu").find("[name='listdata']");
							if(pressdownkey >= hasmenu.length || (hasmenu.length == 0)){
								pressdownkey = 0;
							}
							if(hasmenu.length != 0){
								if(event.which == 40 && (pressdownkey < hasmenu.length)){
									if(pressdownkey != 0){

										hasmenu.eq(pressdownkey - 1).removeClass("keychoice");
									}
									//alert("choiceaim----->run"+hasmenu.eq(pressdownkey).text());
									hasmenu.eq(pressdownkey).addClass("keychoice");
									pressdownkey += 1;
								}
								else if (event.which == 38 && (pressdownkey > 0)) {
									if (pressdownkey != 0) {
										hasmenu.eq(pressdownkey).removeClass("keychoice");
									}
									pressdownkey = pressdownkey - 1;
									hasmenu.eq(pressdownkey).addClass("keychoice");
								}
							}
						}
					})(jQuery);
				</pre>
				<pre class="brush: javascript;">
					(function($){
						$.fn.comparadata = function(serverdata,node) {
							var me = this;
							var customdata = me.getvalue(node);//取得输入框的值
							var servercontent;//纪录是否匹配
							var comparaPinyin;//纪录是否匹配拼音
							
							var getdatacontent = [];//将匹配的项放入这个数组中
						
							for(var i = 0;i<serverdata.length;i++){
								servercontent = serverdata[i].content.indexOf(customdata);//检查是否汉字匹配
								if(customdata != null){
									comparaPinyin = serverdata[i].Pinyin.substring(0,customdata.length).indexOf(customdata);//检查是否拼音匹配
								}
								else{
									comparaPinyin = -1;
								}
								console.log("comparaPinyin====="+serverdata[i].Pinyin);
								if(((servercontent != -1)||(comparaPinyin != -1)) && customdata != null){
									
									getdatacontent.push(serverdata[i]);
								}

							}

							var sortedDatas = getdatacontent.sort(function(a, b){
								if (a.hot > b.hot) {
									return -1;
								} else if (a.hot < b.hot){
									return 1;
								}
								return 0;
							})//对匹配的项按照hot属性进行升序排序

							me.showdata(sortedDatas,node);//交给showdata进行显示
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，用来将输入框中的值，与从服务器取出的值对比，返回匹配的内容，最后将匹配的内容，交给showdata函数处理。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.getvalue = function(node){
							var intercontent = node.val();
							
							if(intercontent == ""){
								return null;
							}
							return intercontent;
							}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，用来取得输入框的值
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.showdata = function(getdatacontent,node) {
							var me = this;
							me.creatNode(node);//创建menu主标签
							var findshowdata = $("#menu").find("[name='showdata']");//查找menu下的显示数据的标签
							if((getdatacontent.length == 0) || (node.val() == "")){
								
								$("#menu").remove();
							}//若是输入框为空，或者出入的数据没有匹配，则删除表单
							else{
								for(var i = 0;i < getdatacontent.length;i++){
									if (findshowdata.length == 0) {
										var menuli = $("<li></li>").addClass("listyle").attr("name","listdata");
										var datalink = $("<a></a>").addClass("linkstyle").attr({"href":getdatacontent[i].url,"name":"showdata"});
										menuli.text(getdatacontent[i].content);
										$("#menuul").append(datalink);
										datalink.append(menuli);
									}//首次创建匹配的标签
									else if(findshowdata.length != 0){

										me.changeinterdata(getdatacontent);
									 }//随着输入的数据变化，增加或减少表单的选项
								}
							}
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，根据传入的数据，创建标签，并传入数据，显示出来。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.creatNode = function(node) {
							var bindingwidth = node.css("width");
							//取得绑定的元素的宽的值，以便设置下拉菜单的宽度
							var bindingoffet = node.offset().left;
							//取得绑定元素的左偏移量
							var hasmenu = $("#bodydiv").find("#menu");
							//查找页面中是否已经存在表单
							var databody = $("<div></div>").attr("id","menu").addClass("menustyle").css({"width":bindingwidth,"left":(bindingoffet+"px")});
							var bodyul = $("<ul></ul>").attr("id","menuul").addClass("ulstyle");//创建菜单列表 
							if(hasmenu.length == 0){
								
								node.after(databody);//不存在表单则创建
							}
							var hasul = $("#menu").find("#menuul");
							
							if(hasul.length == 0){
								
								databody.append(bodyul);//菜单下不存在列表则创建
							}
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，在绑定的标签后创建菜单。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.changeinterdata = function(data) {
							var findshowdata = $("#menu").find("[name='listdata']");
							//查找menu下是否存在显示数据的列表
							var datacomm = [];
							var datalong = data.length - findshowdata.length;
							//大于0则，需显示的项多于，已经显示的，需增加选项。
							if(datalong > 0) {
								
								for (var i = 0; i < findshowdata.length; i++) {
									for (var j = 0; j < data.length; j++) {

										if (findshowdata.eq(i).text() != data[j].content) {
											
											continue;//不相等的项则继续第二层循环
										}

										else {
											console.log("datalong>0 --->444");
											data.splice(j,1);//相等则删除该项，使传入数据，只剩下需要增加的数据项
											break;
										}
									}
								}
								if(data.length != 0){
									//经过上面步骤，还剩下的项，则是需要增加的，下面执行操作。
									for (var i = 0; i < data.length; i++) {

										var menuli = $("<li></li>").addClass("listyle").attr("name","listdata");
										var datalink = $("<a></a>").addClass("linkstyle").attr({"href":data[i].url,"name":"showdata"});
										menuli.text(data[i].content);
										$("#menuul").append(datalink);
										datalink.append(menuli);
									}
								}
							}
							else if(datalong < 0){
								console.log("datalong<0 --->");
								for (var i = 0; i < data.length; i++) {
									for (var j = 0; j < findshowdata.length; j++) {

										if (data[i].content != findshowdata.eq(j).text()) {
											console.log("000000--->");
											findshowdata.eq(j).remove();
											//这里面执行删除，不相同的项。
											continue;
										}
										
									}
								}
							}
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，用来在存在下拉表单的情况下，增加或随者继续输入，增加或减少出现的选项。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.addstyle = function(){
							$("#menu").removeClass("hidemenu").addClass("showmenu");
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数用来给表单添加显示样式。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.hidetyle = function(event){
							$("#menu").removeClass("hidemenu").addClass("showmenu");
							event.stopPropagation();
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，给表单添加隐藏样式。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.togglemenu = function(event) {
							var hasmenu = $("#bodydiv").find("#menu");
							if(hasmenu != 0){
								$("#menu").removeClass("showmenu").addClass("hidemenu");
							}
							event.stopPropagation();
						}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，点击页面不属于输入框部分时，给页面添加隐藏样式。
				</strong>
				<pre class="brush: javascript;">
					(function($){
						$.fn.eventmenu = function() {
							var me = this;
							$("#comment").on("click",function(){
							me.hidetyle(event);
							});
							$(".bodydiv").on("click",function(){
								me.togglemenu(event);
							});
							}
					})(jQuery);
				</pre>
				<strong style="margin-top:10px;display:block;font-size:14px;">
					这个函数，给插件添加点击事件的集合。
				</strong>
		</section>
		<br />
	</div>
	</div>
</body>
</html>